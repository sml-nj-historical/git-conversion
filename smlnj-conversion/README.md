# Migration notes for the primary smlnj distribution

Can be seen at https://github.com/sml-nj/smlnj

This was a lot of work for the way I wanted to organize the layout -- only keep projects in the main smlnj git repo that get shipped in a release (except "doc" that seemed completely disconnected from the source code) and separate out all others into their own git repos.

## Steps
This migration is a two step process because of the pathological cases I needed to handle manually.
1. First do the git conversion using the reposurgeon `--nobranch` READ option and remove leading whitespace from all commits as usual; follow by expunges of paths (separate projects) that have already been converted into their own git repos; finally, do a coalesce operation to merge similar commits (especially those for releases) together. Write out a subversion repo from this state.

    Steps look something like what follows, reposurgeon crashes on the commented out steps if executed in a single go, but they still can be done one by one.
    
    ```
    read .
    prefer git
    expunge /^dev-notes/
    expunge /^archive/
    expunge /^rpm-dist/
    expunge /^doc/
    expunge /^osx-dist/
    expunge /^papers/
    expunge /^lexgen/
    expunge /^admin/
    # expunge /^tests/
    # expunge /^benchmarks/
    # expunge /^sml-mode/
    # expunge /^pages/
    coalesce --debug --changelog
    ```

2. From the subversion repo obtained in the first step, do another conversion this time without the `--nobranch` READ option, so reposurgeon can do its branch analysis. The scripts in this directory pertain to this second step. Even from here some manual surgery is needed, especially, manual correction for quirky branches and releases directory additions (a side effect of how subversion handles branches and tags).

    Before the final upload to github, filter out top level autogenerated .gitignore using `make rmignore` and follow by `make gc`.
